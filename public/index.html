<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Meld opp kadidat</title>
</head>

<script src="./socket.io.js"></script>


<body>
    <p>Meld inn kandidat</p>
    <form id="myForm" action="">
        Kandidat id: <input type="text" name="fname"><br>
        <button id="myButton" type="submit">Meld opp</button>
    </form>

    <p>Kandidater</p>
    <ul id="kandidater">

    </ul>
</body>

<script>

    var socket = io.connect('https://vegvesen.herokuapp.com');
    
    socket.on('all-users', function (users) {
        printUsers(users);
    });

    document.getElementById("myForm").addEventListener("submit", function (e) {

        e.preventDefault();

        var bruker = e.target['fname'].value

        socket.emit('new-user', { user: bruker });

        e.target.reset();
    });
    setTimeout(() => {
        socket.emit('init');
    }, 200)

    socket.on('init-user-load', (users) => {
        console.log('all users', users);
    })

    socket.on('new-user-emitted', function (users) {
        printUsers(users);
    });

    function printUsers(users) {
        var ul = document.getElementById('kandidater');
        ul.innerHTML = null;
        users.forEach(element => {
            var li = document.createElement('li');
            li.setAttribute('class', 'item');
            li.innerHTML = li.innerHTML + element

            ul.appendChild(li);
        });
    }
</script>

</html>